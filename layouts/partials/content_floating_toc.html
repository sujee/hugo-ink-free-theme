<!-- Inspired by https://iamsorush.com/posts/table-of-content-blog/ -->
<div class="article-nav" id="article-nav-id">
    <div class="post">
        {{ partial "post_header.html" . }}

        <!-- The TOC will be static on mobile decides -->
        {{ if and (gt .WordCount 400 ) (eq .Site.Params.toc "both") }}
        <aside class="toc" id="static-toc">
            <header>
                <h3>Contents</h3>
            </header>
            {{.TableOfContents}}
        </aside>
        {{ else }}
        <aside class="show-on-mobile toc" id="static-toc">
            <header>
                <h3>Contents</h3>
            </header>
            {{.TableOfContents}}
        </aside>
        {{ end }}

        {{ .Content }}
        
        <div class="related-events">
            <h3>Related Events</h3>
            {{ $related := .Site.RegularPages.Related . | first 5 }}
            {{ if $related }}
            <ul class="related-list">
                {{ range $related }}
                <li class="related-item">
                    <a href="{{ .RelPermalink }}" class="related-link">
                        <strong>{{ .Title }}</strong>
                        {{ if .Params.event_date }}
                        <span class="related-date">{{ dateFormat "Jan 2, 2006" .Params.event_date }}</span>
                        {{ end }}
                    </a>
                    {{ if .Params.topics }}
                    <div class="related-topics">
                        {{ range first 3 .Params.topics }}
                        <span class="topic-tag">{{ . }}</span>
                        {{ end }}
                    </div>
                    {{ end }}
                </li>
                {{ end }}
            </ul>
            {{ else }}
            <p style="font-style: italic; color: #666;">No related events found.</p>
            {{ end }}
        </div>

    </div>
    <nav class="hide-on-mobile section-nav">
        {{ .TableOfContents }}
    </nav>
</div>
<div class="post">
    {{ partial "article_footer.html" . }}
</div>
